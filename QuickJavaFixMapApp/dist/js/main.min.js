/*! P5-1-Neighborhood-Map-App 2016-02-12 */
var app=function(){function a(){return Math.floor(1e12*Math.random()).toString()}var b,c,d,e=this,f={lat:51.0486,lng:-114.0708},g={panControl:!0,zoomControl:!0,zoom:14,center:f},h="coffee shops",i=ko.observable(!1),j=ko.observable(!1);this.locations=[];var k=function(a){e.locs=a},l=function(){return locations},m=function(b){var d="GET",g="fjRNEsukXhL1FB3CIqPcag",h="eCHECnGvppAsgd3VNUvDbdr032g",k="https://api.yelp.com/v2/search?",l="Rf1FlIlCejJyFN5nTH-86SvRb4yo1Mrt",m=f.lat+","+f.lng,n="SbogXKxFUTSRLRi8OaqReMjzBzs",o={term:b,ll:m,oauth_consumer_key:g,oauth_token:l,oauth_nonce:a(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",callback:"cb"},p=oauthSignature.generate(d,k,o,h,n);o.oauth_signature=p;var q={url:k,data:o,cache:!0,dataType:"jsonp",success:function(a){console.log("YELP success %o",a);for(var b=0;b<a.businesses.length;b++)r({location:a.businesses[b],marker:a.businesses[b]}),e.locations.push({location:a.businesses[b],marker:c});ko.applyBindings(new ViewModel)},error:function(a){ko.applyBindings(new ViewModel),i===!1&&j(!0),console.log("YELP error %o",a)}};$.ajax(q)},n=function(a){f.lat=a.coords.latitude,f.lng=a.coords.longitude,b.setCenter(f),k(f),q(),m(h)},o=function(a){a=!0,q(),m(h)},p=function(){b=new google.maps.Map(document.getElementById("mapSection"),g),e.map=b,"geolocation"in navigator?navigator.geolocation.getCurrentPosition(n,o):o(!1)},q=function(){new google.maps.Marker({position:b.getCenter(),icon:{path:google.maps.SymbolPath.CIRCLE,scale:5},clickable:!1,map:b})},r=function(a){var d={lat:a.location.location.coordinate.latitude,lng:a.location.location.coordinate.longitude};c=new google.maps.Marker({map:b,animation:google.maps.Animation.DROP,position:d,title:a.location.id}),t(a)},s=function(a){a.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){a.setAnimation(null)},1400)},t=function(a){d=new google.maps.InfoWindow,google.maps.event.addListener(c,"click",function(){s(this),u(a),d.open(b,this),b.panTo(this.getPosition())})},u=function(a){void 0===a.location.image_url&&(a.location.image_url=""),void 0===a.location.snippet_text&&(a.location.snippet_text=""),void 0===a.location.display_phone&&(a.location.display_phone="");var b='<div class="infoWindow-Container"><div class="infoWindow-Content-Top"><div class="infoWindow-Content-Left"><h5 data-bind="text: name">'+a.location.name+'</h5><img src="'+a.location.rating_img_url+'" alt="" data-bind="attr: {src: rating_img_url}"/><span data-bind="text: rating">  '+a.location.rating+'</span><br><i class="fa fa-phone-square"></i>  '+a.location.display_phone+'</div><div class="infoWindow-Content-Right"><img src="'+a.location.image_url+'" alt="" data-bind="visible: location.image_url"/></div></div><div class="infoWindow-Content-Bottom"><p data-bind="text: snippet_text">'+a.location.snippet_text+'</p><a href="'+a.location.mobile_url+'" target="_blank" data-bind="attr: {href: yelpURL}, visible: yelpURL">Click here to view details on Yelp</a></div></div>';d.setContent(b)},v=function(a){s(a.marker());for(var c=0;c<self.locations.length;c++)if(a.id()===self.locations[c].location.id){u(self.locations[c]);break}d.open(b,a.marker()),b.panTo(a.marker().getPosition())};return"undefined"!=typeof google?p():(i(!0),m(" ")),{map:b,setGeoLocs:k,getLocations:l,selectListMarker:v,mapBindingError:i,yelpBindingError:j}}();