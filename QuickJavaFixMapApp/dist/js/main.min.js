/*! P5-1-Neighborhood-Map-App 2016-02-07 */
var app=function(){function a(){return Math.floor(1e12*Math.random()).toString()}var b,c,d,e=this,f={lat:51.0486,lng:-114.0708},g={panControl:!0,zoomControl:!0,zoom:14,center:f},h="coffee shops";this.locations=[];var i=function(a){e.locs=a},j=function(){return locations},k=function(b){var d="GET",g="fjRNEsukXhL1FB3CIqPcag",h="eCHECnGvppAsgd3VNUvDbdr032g",i="https://api.yelp.com/v2/search?",j="Rf1FlIlCejJyFN5nTH-86SvRb4yo1Mrt",k=f.lat+","+f.lng,l="SbogXKxFUTSRLRi8OaqReMjzBzs",m={term:b,ll:k,oauth_consumer_key:g,oauth_token:j,oauth_nonce:a(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",callback:"cb"},n=oauthSignature.generate(d,i,m,h,l);m.oauth_signature=n;var o={url:i,data:m,cache:!0,dataType:"jsonp",success:function(a){console.log("YELP success %o",a);for(var b=0;b<a.businesses.length;b++)p({location:a.businesses[b],marker:a.businesses[b]}),e.locations.push({location:a.businesses[b],marker:c});ko.applyBindings(new ViewModel)},error:function(a){$(".left-panel-items").append('<li><p class="bg-danger">Oops...Something went wrong in contacting Yelp. Please refresh or try later.</p></li>'),console.log("YELP error %o",a)}};$.ajax(o)},l=function(a){f.lat=a.coords.latitude,f.lng=a.coords.longitude,b.setCenter(f),i(f),o(),k(h)},m=function(a){a=!0,o(),k(h)},n=function(){b=new google.maps.Map(document.getElementById("mapSection"),g),e.map=b,"geolocation"in navigator?navigator.geolocation.getCurrentPosition(l,m):m(!1)},o=function(){new google.maps.Marker({position:b.getCenter(),icon:{path:google.maps.SymbolPath.CIRCLE,scale:5},clickable:!1,map:b})},p=function(a){var d={lat:a.location.location.coordinate.latitude,lng:a.location.location.coordinate.longitude};c=new google.maps.Marker({map:b,animation:google.maps.Animation.DROP,position:d,title:a.location.id}),r(a)},q=function(a){a.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){a.setAnimation(null)},1400)},r=function(a){d=new google.maps.InfoWindow,google.maps.event.addListener(c,"click",function(){q(this),s(a),d.open(b,this),b.panTo(this.getPosition())})},s=function(a){void 0===a.location.image_url&&(a.location.image_url=""),void 0===a.location.snippet_text&&(a.location.snippet_text=""),void 0===a.location.display_phone&&(a.location.display_phone="");var b='<div class="infoWindow-Container"><div class="infoWindow-Content-Top"><div class="infoWindow-Content-Left"><h5 data-bind="text: name">'+a.location.name+'</h5><img src="'+a.location.rating_img_url+'" alt="" data-bind="attr: {src: rating_img_url}"/><span data-bind="text: rating">  '+a.location.rating+'</span><br><i class="fa fa-phone-square"></i>  '+a.location.display_phone+'</div><div class="infoWindow-Content-Right"><img src="'+a.location.image_url+'" alt="" data-bind="visible: location.image_url"/></div></div><div class="infoWindow-Content-Bottom"><p data-bind="text: snippet_text">'+a.location.snippet_text+'</p><a href="'+a.location.mobile_url+'" target="_blank" data-bind="attr: {href: yelpURL}, visible: yelpURL">Click here to view details on Yelp</a></div></div>',c={width:50,height:0};d.setContent(b),d.setOptions({pixelOffset:c})},t=function(a){q(a.marker());for(var c=0;c<self.locations.length;c++)if(a.id()===self.locations[c].location.id){s(self.locations[c]);break}d.open(b,a.marker()),b.panTo(a.marker().getPosition())};if("undefined"!=typeof google)n();else{var u=document.getElementsByClassName("left-panel");$(u).css("display","none"),$("body").append('<p class="bg-danger">Oops...Something went wrong with Google maps. Please refresh or try later and either accept or decline the geolocation request.</p>')}return{map:b,setGeoLocs:i,getLocations:j,selectListMarker:t}}();